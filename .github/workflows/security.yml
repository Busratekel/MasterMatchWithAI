name: ğŸ”’ GÃ¼venlik KontrolÃ¼

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

jobs:
  security-check:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Repository'yi Ã§ek
      uses: actions/checkout@v4
      
    - name: ğŸ” Hassas dosya kontrolÃ¼
      run: |
        echo "ğŸ” Hassas dosyalar kontrol ediliyor..."
        
        # YasaklÄ± dosyalarÄ± kontrol et
        FORBIDDEN_FILES=(
          ".env"
          ".env.local"
          ".env.production"
          "backend/.env"
          "frontend/.env"
          "*.key"
          "*.pem"
          "*.p12"
          "credentials.json"
          "service-account.json"
          "database.db"
        )
        
        VIOLATIONS=()
        
        for file in "${FORBIDDEN_FILES[@]}"; do
          if find . -name "$file" -type f | grep -q .; then
            VIOLATIONS+=("$file")
          fi
        done
        
        if [ ${#VIOLATIONS[@]} -ne 0 ]; then
          echo "âŒ GÃ¼venlik ihlali tespit edildi!"
          echo "YasaklÄ± dosyalar:"
          printf '%s\n' "${VIOLATIONS[@]}"
          echo "ğŸš¨ Bu dosyalar gÃ¼venlik nedeniyle yÃ¼klenemez!"
          exit 1
        else
          echo "âœ… Hassas dosya kontrolÃ¼ baÅŸarÄ±lÄ±"
        fi
        
    - name: ğŸ” Hassas bilgi taramasÄ±
      run: |
        echo "ğŸ” Kod iÃ§inde hassas bilgiler aranÄ±yor..."
        
        # Hassas pattern'leri kontrol et
        SENSITIVE_PATTERNS=(
          "password.*=.*['\"][^'\"]*['\"]"
          "secret.*=.*['\"][^'\"]*['\"]"
          "api_key.*=.*['\"][^'\"]*['\"]"
          "token.*=.*['\"][^'\"]*['\"]"
          "DATABASE_URL.*=.*['\"][^'\"]*['\"]"
          "MAIL_PASSWORD.*=.*['\"][^'\"]*['\"]"
        )
        
        VIOLATIONS=()
        
        for pattern in "${SENSITIVE_PATTERNS[@]}"; do
          if grep -r --include="*.py" --include="*.js" --include="*.jsx" --include="*.json" "$pattern" . | grep -v "env_example" | grep -v "env.example" | grep -q .; then
            VIOLATIONS+=("$pattern")
          fi
        done
        
        if [ ${#VIOLATIONS[@]} -ne 0 ]; then
          echo "âŒ Hassas bilgi tespit edildi!"
          echo "Bulunan pattern'ler:"
          printf '%s\n' "${VIOLATIONS[@]}"
          echo "ğŸš¨ Bu bilgiler environment deÄŸiÅŸkenlerinde saklanmalÄ±!"
          exit 1
        else
          echo "âœ… Hassas bilgi kontrolÃ¼ baÅŸarÄ±lÄ±"
        fi
        
    - name: ğŸ“‹ .gitignore kontrolÃ¼
      run: |
        echo "ğŸ“‹ .gitignore dosyasÄ± kontrol ediliyor..."
        
        REQUIRED_IGNORES=(
          ".env"
          "*.log"
          "node_modules/"
          "venv/"
          "__pycache__/"
          "*.db"
        )
        
        MISSING_IGNORES=()
        
        for ignore in "${REQUIRED_IGNORES[@]}"; do
          if ! grep -q "^$ignore$" .gitignore; then
            MISSING_IGNORES+=("$ignore")
          fi
        done
        
        if [ ${#MISSING_IGNORES[@]} -ne 0 ]; then
          echo "âš ï¸  .gitignore'da eksik kurallar:"
          printf '%s\n' "${MISSING_IGNORES[@]}"
          echo "ğŸ’¡ Bu kurallarÄ± .gitignore'a ekleyin"
        else
          echo "âœ… .gitignore kontrolÃ¼ baÅŸarÄ±lÄ±"
        fi
        
    - name: ğŸ“ GÃ¼venlik raporu
      run: |
        echo "ğŸ“ GÃ¼venlik kontrolÃ¼ tamamlandÄ±!"
        echo "âœ… Proje gÃ¼venlik standartlarÄ±na uygun"
        echo "ğŸ”’ Hassas bilgiler korunuyor"
        echo "ğŸ“‹ .gitignore doÄŸru yapÄ±landÄ±rÄ±lmÄ±ÅŸ" 